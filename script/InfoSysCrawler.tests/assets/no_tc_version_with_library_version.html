<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html[]><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Script-Type" content="text/javascript" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="baseid" content="10939405451" /><meta name="releaseid" content="10939405451" /><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" /><link layout-comment="Pfad-Trafo: concat('../', $source)" rel="stylesheet" href="../../../assets/css/base/01-bootstrap.min.css" /><link layout-comment="Pfad-TRAfo: ctrl:If(@class='MultiLangRoot', $source, concat('../', $source))" rel="stylesheet" href="../../../assets/css/formats.css" /><link layout-comment="Pfad-Trafo: ctrl:If(@class='MultiLangRoot', $source, concat('../', $source))" rel="stylesheet" href="../../../assets/css/formats.css" /><link layout-comment="Pfad-Trfo: ctrl:If(@class='MultiLangRoot', $source, concat('../', $source))" rel="stylesheet" href="../../../assets/css/formats.css" /><title>FB_KinCalcMultiTrafo</title><meta http-equiv="content-type" content="text/html; charset=utf-8" /><meta http-equiv="Content-Language" content="en" /><meta name="date" content="637756416000000000" /><meta name="generator" content="onlineInfoSysConverter" /><meta name="Robots" content="index, follow" /><script src="../../../includes/styles.js" type="text/javascript" language="JavaScript"></script><script src="../../../includes/prettify/prettify.js" type="text/javascript" language="JavaScript"></script><script src="../../../includes/prettify/lang-st.js" type="text/javascript" language="JavaScript"></script><link rel="stylesheet" type="text/css" href="../../../css/prettify/prettify.css" /><meta name="parent" content="1955651339" /><meta name="level" content="7" /><meta name="description" content="The function block FB_KinCalcMultiTrafo calculates the forward or backward transformation for several positions, even if no kinematic group was created with FB_KinConfigGroup..." /><meta name="product" content="TF5xxx - Motion" /><meta name="category" content="TFxxxx | TwinCAT 3 Functions" /><meta name="productgroup" content="TwinCAT 3" /><meta name="microsoft_help" content="FB_KinCalcMultiTrafo" /><meta name="topicid" content="10939405451" /><meta name="primaryid" content="3106309289728839985" /></head><body id="10939405451" lang="en-US" data-node-id="10939405451" class="" data-culture="en-US" onload="prettyPrint()"><header class="d-print-none"><ol class="breadcrumb "><li><a href="index.html">TF511x | TwinCAT 3 Kinematic Transformation</a></li><li></li><li></li></ol></header><article role="main" aria-labelledby="heading-10939405451"><h1 class="heading" style="color:black;">FB_KinCalcMultiTrafo</h1><div class="metalist"></div><figure class="img_original"><img src="Images/svg/11107480843__Web.svg" width="491" height="149" alt="FB_KinCalcMultiTrafo 1:" /></figure><p>The function block FB_KinCalcMultiTrafo calculates the forward or backward transformation for several positions, even if no kinematic group was created with <a href="1955711627.html">FB_KinConfigGroup</a>.</p><p>Alternatively, the function block <a href="1955795083.html">FB_KinCalcTrafo</a> can be used to calculate the kinematic transformations individually.</p><h2 class="subheading"><img style="vertical-align: baseline;" src="Images/bmp/4199090059__Web.bmp" alt="FB_KinCalcMultiTrafo 2:" /> Inputs</h2><table class="table tabletype-header table-fixed"><colgroup><col style="width: 14.7%;"></col><col style="width: 18.3%;"></col><col style="width: 66.9%;"></col></colgroup><thead><tr><th><p>Name</p></th><th><p>Type</p></th><th><p>Description</p></th></tr></thead><tbody><tr><td><p>bExecute</p></td><td><p>BOOL</p></td><td><p>The command is triggered by a rising edge at this input.</p></td></tr><tr><td><p>bForward</p></td><td><p>BOOL</p></td><td><p>Determines whether the forward or backward transformation is calculated.</p></td></tr><tr><td><p>oidTrafo</p></td><td><p>UDINT</p></td><td><p>Object ID of the kinematic transformation object to be calculated.</p></td></tr><tr><td><p>pDataIn</p></td><td><p>POINTER TO BYTE</p></td><td><p>Pointer to the input data, consisting of an instance of <a href="11107490827.html">ST_KinMultiTrafoHeader</a> and an array of input positions. For the calculation of a forward transformation they represent the joint positions. For the calculation of a backward transformation they represent the Cartesian axis positions.</p></td></tr><tr><td><p>nSizeIn</p></td><td><p>UDINT</p></td><td><p>Size of the input data to which pDataIn points</p></td></tr><tr><td><p>pDataOut</p></td><td><p>POINTER TO BYTE</p></td><td><p>Pointer to the output data.</p></td></tr><tr><td><p>nSizeOut</p></td><td><p>UDINT</p></td><td><p>Size of the output data to which pDataOut points.</p></td></tr></tbody></table><div class="p"></div><h2 class="subheading"><img style="vertical-align: baseline;" src="Images/bmp/4199093771__Web.bmp" alt="FB_KinCalcMultiTrafo 3:" /> Outputs</h2><table class="table tabletype-header table-fixed"><colgroup><col style="width: 14.8%;"></col><col style="width: 18.1%;"></col><col style="width: 67.0%;"></col></colgroup><thead><tr><th><p>Name</p></th><th><p>Type</p></th><th><p>Description</p></th></tr></thead><tbody><tr><td><p>bBusy</p></td><td><p>BOOL</p></td><td><p>The output becomes TRUE when the command is started with bExecute and remains TRUE as long as the function block executes the command. While bBusy is TRUE, no new command is accepted at the inputs. If bBusy becomes FALSE again, the function block is ready for a new command. At the same time one of the outputs bDone or bError is set.</p></td></tr><tr><td><p>bDone</p></td><td><p>BOOL</p></td><td><p>The output becomes TRUE when the command was executed successfully.</p></td></tr><tr><td><p>bError</p></td><td><p>BOOL</p></td><td><p>The output bError is set to TRUE, if an error occurred during the command execution.</p></td></tr><tr><td><p>nErrorId</p></td><td><p>UDINT</p></td><td><p>Contains the command-specific error code of the most recently executed command. Details of the error code can be found in the <a target="_blank" href="../tc3_ads_intro/374277003.html">ADS error documentation</a> or in the <a target="_blank" href="../tc3ncerrcode/1521556875.html">NC error documentation</a> (error codes from 0x4000).</p></td></tr></tbody></table><div class="p"></div><h2 class="subheading"><strong>Sample</strong></h2><p>ST_KinCalcMultiTrafoIn</p><pre class="prettyprint lang-st">TYPE ST_KinCalcMultiTrafoIn :<br />STRUCT<br />    hdr  : ST_KinMultiTrafoHeader;<br />    fPos : ARRAY[1..2] OF ARRAY[1..4] OF LREAL;<br />END_STRUCT<br />END_TYPE</pre><div class="p"></div><p>ST_KinCalcMultiTrafoOut</p><pre class="prettyprint lang-st">TYPE ST_KinCalcMultiTrafoOut :<br />STRUCT<br />    fPos      : ARRAY[1..2] OF ARRAY[1..4] OF LREAL;<br />    fMetaInfo : ARRAY[1..2] OF U_KinMetaInfo;<br />END_STRUCT<br />END_TYPE</pre><div class="p"></div><p>MAIN</p><pre class="prettyprint lang-st">PROGRAM MAIN<br />VAR<br />    {attribute 'TcInitSymbol'} oidKinematic: OTCID;<br />    nState: UDINT := 0;<br /><br />    fbKinCalcMultiTrafo   : FB_KinCalcMultiTrafo;<br />    stKinCalcMultiIn      : ST_KinCalcMultiTrafoIn; <br />    stKinCalcMultiOut     : ST_KinCalcMultiTrafoOut; <br />END_VAR</pre><pre class="prettyprint lang-st">CASE nState OF<br />0:<br />    // Header for Multi Trafo<br />    stKinCalcMultiIn.hdr.nColumnsIn := 4;<br />    stKinCalcMultiIn.hdr.nColumnsOut := 4;<br />    stKinCalcMultiIn.hdr.nLines := 2;<br />    stKinCalcMultiIn.hdr.uMetaInfo.eScara := E_KinMetaInfoScara.scaraLeftArm;<br />    stKinCalcMultiIn.hdr.bGetMetaInfo := TRUE;<br /><br />    // Positions<br />    stKinCalcMultiIn[1][1]:=0;<br />    stKinCalcMultiIn[1][2]:=90;<br />    stKinCalcMultiIn[1][3]:=0;<br />    stKinCalcMultiIn[1][4]:=0;<br /><br />    stKinCalcMultiIn[2][1]:=0;<br />    stKinCalcMultiIn[2][2]:=-90;<br />    stKinCalcMultiIn[2][3]:=0;<br />    stKinCalcMultiIn[2][4]:=0;<br /><br />    nState := nState + 10;<br /><br />10:<br />    fbKinCalcMultiTrafo( bExecute := TRUE, <br />                         bForward := TRUE,<br />                         oidTrafo := oidKinematic,<br />                         pDataIn  := ADR(stKinCalcMultiIn), <br />                         nSizeIn  := SIZEOF(stKinCalcMultiIn), <br />                         pDataOut := ADR(stKinCalcMultiOut), <br />                         nSizeOut := SIZEOF(stKinCalcMultiOut) );<br /><br />    IF NOT fbKinCalcMultiTrafo.bBusy THEN<br />        fbKinCalcMultiTrafo(bExecute:= FALSE, bForward:= TRUE, oidTrafo:= oidKinematic,<br />                            pDataIn:=ADR(stKinCalcMultiIn), nSizeIn:= SIZEOF(stKinCalcMultiIn),<br />                            pDataOut:=ADR(stKinCalcMultiOut), nSizeOut:= SIZEOF(stKinCalcMultiOut) );<br /><br />        nState := nState + 10;<br />    END_IF<br />END_CASE</pre><h2 class="subheading">Requirements</h2><table class="table tabletype-header table-fixed"><colgroup><col style="width: 33.3%;"></col><col style="width: 33.3%;"></col><col style="width: 33.3%;"></col></colgroup><thead><tr><th><p><strong>Development environment</strong></p></th><th><p><strong>Target system type</strong></p></th><th><p><strong>PLC libraries to include</strong></p></th></tr></thead><tbody><tr><td><p>Advanced Motion Pack V3.1.10.51</p></td><td><p>PC or CX (x64)</p></td><td><p>Tc2_NcKinematicTransformation</p></td></tr></tbody></table></article><footer><p class="text-muted">© 2021 Beckhoff Automation</p></footer><script src="../../../../assets/js/00-jquery.min.js"></script><script src="../../../../assets/js/01-bootstrap.min.js"></script></body></html>
